<app-template>
  <!--Zone de la navbar -->
  <app-home-button></app-home-button>
  <app-medium-button class="navbar-button" [routerLink]="['/ergo-config-selected']" routerLinkActive="active">
    <p class="name">
      <app-user-card [user]="selectedUser" class="horizontal navbar" />
    </p>
  </app-medium-button>
  <app-medium-button class="navbar-button red" [routerLink]="['/ergo-play']"> Retour </app-medium-button>
  <app-medium-button class="navbar-button" [routerLink]="['/ergo-stat-selected']"> Statistiques </app-medium-button>




  <!--Zone du main -->
  <app-inner-box class="main-box blue">
    <!-- Save confirmation message -->
    <div class="save-confirmation-container">
      <div class="save-confirmation" *ngIf="saveConfirmationVisible">
        Configuration sauvegardée automatiquement a chaque modification.
      </div>
    </div>

    <span>NOM : {{ selectedUser?.name }}</span>
    <span>Âge : {{selectedUser?.age}} ans</span>
    <span>Troubles: {{selectedUser?.conditions}} </span>



    <div class="config-item operation-selector">
      <h3>Types de Questions</h3>

      <!-- Selected operations pills (similar to ergo-input-child-page) -->
      <div class="selected-operations" *ngIf="getSelectedOperations().length > 0">
        <div *ngFor="let operation of getSelectedOperations()" class="operation-pill">
          {{getOperationLabel(operation)}}
          <span class="remove-operation" (click)="toggleOperation(operation)">×</span>
        </div>
      </div>

      <!-- Dropdown for question types -->
      <div class="dropdown-wrapper">
        <select #operationSelect class="operations-dropdown" (change)="handleOperationSelection(operationSelect.value)">
          <option value="" disabled selected>Sélectionner un type</option>
          <option *ngFor="let op of availableOperations" [value]="op.key" [disabled]="isOperationSelected(op.key)">
            {{op.label}}
          </option>
        </select>
      </div>
    </div>

    <div class="advanced-stats-section">
      <div class="advanced-stats-grid">
        <!-- Show Answers toggle -->
        <div class="advanced-stat-cell">
          <span>Montrer les réponses</span>
          <app-settings-toggle [checked]="currentConfig.showAnswer"
            (valueChange)="onToggleChange('showAnswer', $event)">
          </app-settings-toggle>
        </div>
        <!-- Show Score toggle -->
        <div class="advanced-stat-cell">
          <span>Afficher le score</span>
          <app-settings-toggle [checked]="currentConfig.showScore" (valueChange)="onToggleChange('showScore', $event)">
          </app-settings-toggle>
        </div>
        <!-- Nombre de questions input -->
        <div class="advanced-stat-cell">
          <span>Nombre de questions</span>
          <input #nombreInput type="text" min="1" [value]="currentConfig.nombresDeQuestion || ''"
            (input)="onNombreDeQuestionInput(nombreInput)" class="frequency-input" />
        </div>
        <!-- Frequency inputs for each operation -->
        <div *ngFor="let op of availableOperations" class="advanced-stat-cell">
          <span>{{ op.label }}</span>
          <input #freqInput type="text" [value]="currentConfig.questionFrequency?.[op.key] ?? ''"
            (input)="onFrequencyInput(freqInput, op.key)" class="frequency-input" />
        </div>

        <!-- Frequency inputs for each letter -->
        <div *ngFor="let letter of topMissedLetters" class="advanced-stat-cell">
          <span>{{ letter.label }}</span>
          <input #letterFreqInput type="text" [value]="letterFrequencies[letter.key] ?? ''"
            (input)="onFrequencyInput(letterFreqInput, letter.key)" class="frequency-input" />
        </div>
      </div>
    </div>
  </app-inner-box>
</app-template>