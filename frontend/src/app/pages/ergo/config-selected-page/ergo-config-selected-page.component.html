<app-template>
  <!--Zone de la navbar -->
  <app-home-button></app-home-button>
  <app-medium-button class="navbar-button" [routerLink]="['/ergo-config-selected']" routerLinkActive="active">
    <p class="name">
        <app-user-card [user]="selectedUser" class="horizontal navbar"/>
    </p>
  </app-medium-button>
  <app-medium-button class="navbar-button red" [routerLink]="['/ergo-play']"> Retour </app-medium-button>
  <app-medium-button class="navbar-button" [routerLink]="['/ergo-stat-selected']"> Statistiques </app-medium-button>




  <!--Zone du main -->
  <app-inner-box class="main-box blue">
    <!-- Save confirmation message -->
    <div class="save-confirmation-container">
      <div class="save-confirmation" *ngIf="saveConfirmationVisible">
        Configuration sauvegardée automatiquement a chaque modification.
      </div>
    </div>

    <span>NOM : {{ selectedUser?.name }}</span>
    <span>Âge : {{selectedUser?.age}} ans</span>
    <span>Troubles: {{selectedUser?.conditions}} </span>



    <div class="config-item operation-selector">
      <h3>Types de Questions</h3>

      <!-- Selected operations pills (similar to ergo-input-child-page) -->
      <div class="selected-operations" *ngIf="getSelectedOperations().length > 0">
        <div *ngFor="let operation of getSelectedOperations()" class="operation-pill">
          {{getOperationLabel(operation)}}
          <span class="remove-operation" (click)="toggleOperation(operation)">×</span>
        </div>
      </div>

      <!-- Dropdown for question types -->
      <div class="dropdown-wrapper">
        <select #operationSelect class="operations-dropdown" (change)="handleOperationSelection(operationSelect.value)">
          <option value="" disabled selected>Sélectionner un type</option>
          <option *ngFor="let op of availableOperations"
                  [value]="op.key"
                  [disabled]="isOperationSelected(op.key)">
            {{op.label}}
          </option>
        </select>
      </div>
    </div>

<!-- Settings in columns -->
    <div class="settings-columns">
      <!-- Column 1 -->
      <div class="settings-column">
        <!-- Show Answers toggle -->
        <div class="toggle-row">
          <span class="toggle-label">Montrer les réponses</span>
          <app-settings-toggle
            [checked]="currentConfig.showAnswer"
            (valueChange)="onToggleChange('showAnswer', $event)">
          </app-settings-toggle>
        </div>

        <div class="toggle-row advanced-statistics-toggle" (click)="toggleAdvancedStats()"
          style="cursor:pointer;user-select:none;">
          <span class="toggle-label">
            Statistiques avancées
            <span [ngClass]="{'arrow-down': showAdvancedStats, 'arrow-left': !showAdvancedStats}">
              {{ showAdvancedStats ? '▼' : '►' }}
            </span>
          </span>
        </div>
      </div>
      <!-- Column 2 -->
      <div class="settings-column">      
        <!-- Show Score toggle -->
        <div class="toggle-row">
          <span class="toggle-label">Afficher le score</span>
          <app-settings-toggle
            [checked]="currentConfig.showScore"
            (valueChange)="onToggleChange('showScore', $event)">
          </app-settings-toggle>
        </div>

        <!-- Nombre de questions input -->
        <div class="toggle-row">
          <span class="toggle-label">Nombre de questions</span>
          <input
            #nombreInput
            type="text"
            min="1"
            [value]="currentConfig.nombresDeQuestion || ''"
            (input)="onNombreDeQuestionInput(nombreInput)"
            class="number-input"
            style="width: 60px; margin-left: 10px;"
          />
        </div>
        <!-- Additional features -->
      </div>


    </div>

    <!-- Advanced stats section, outside the settings-columns row -->
    <div class="advanced-stats-section" *ngIf="showAdvancedStats">
      <div class="advanced-stats-grid">
        <div *ngFor="let op of availableOperations" class="advanced-stat-cell">
          <span>{{ op.label }}</span>
          <input
            #freqInput
            type="text"
            [value]="currentConfig.questionFrequency?.[op.key] ?? ''"
            (input)="onFrequencyInput(freqInput, op.key)"
            class="frequency-input"
            style="width: 60px; margin-left: 10px;"
          />
        </div>
      </div>
    </div>
  </app-inner-box>
</app-template>